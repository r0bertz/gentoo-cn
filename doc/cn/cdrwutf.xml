<?xml version='1.0' encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="/xsl/guide.xsl" ?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/www/www.gentoo.org/raw_cvs/gentoo/xml/htdocs/doc/en/metadata.xml,v 1.4 2004/03/07 12:12:53 swift Exp $ -->

<guide link="/doc/zh_cn/win4lin.xml">
<title>CD-RW光盘的随读随写</title>

<author title="Author">
  <mail link="">aent</mail>
</author>
<author title="Translator/Editor">
  <mail link="joanphan@gmail.com">Hans Joanphan</mail>
</author>

<abstract>
用CD-RW和用软盘一样，往已挂载的CD-ROM上拖放就行。
</abstract>

<license/>

<version>0.1</version>
<date>2004年7月22日</date>

<chapter>
<title>正文</title>
<body>

<p>
对于那些想在gentoo下使用CD-RW就跟使用软盘一样时，不用再找了！
</p>

<p>
目标：用CD-RW和用软盘一样，往已挂载的CD-ROM上拖放就行。在CD-RW文件系统中使用UDF，这样将和Nero InCD相兼容。
</p>

<note>
所有的电脑必须有UDF读支持，才能读出用这种方法刻录的CDs。这就意味着所有的Windows机器都必须安装Nero InCD，所有的Linux机器都必须在内核选项中选中UDF读支持。
</note>

<p>
下载合适你内核的补丁，并用bunzip2打开它。
</p>

<pre>
# cd ~ &amp;&amp; wget http://w1.894.telia.com/~u89404340/patches/packet/2.6/packet-2.6.5.patch.bz2 
# bunzip2 packet-*
</pre>

<p>
检查并确信符号连接/usr/src/linux只想你希望打补丁的内核
</p>

<pre>
# ls -l /usr/src
</pre>

<p>
进入内核所在文件夹并打上这个补丁
</p>

<pre>
# cd /usr/src/linux
# patch -p1 ~/packet-2.6.5.patch
</pre>

<p>
运行<c>make menuconfig</c>进入内核配置，选中如下的选项：
</p>

<pre>
Device Drivers  --->
                     Block devices  --->
                                         &lt;*&gt; Packet writing on CD/DVD media (EXPERIMENTAL)
                                         (8)   Free buffers for data gathering
                                         [ ]   Enable write caching
File systems  --->
                     CD-ROM/DVD Filesystems  ---> 
                                                 &lt;*&gt; UDF file system support
                                                 (on 2.4 kernels, reading and writing is separate options, enable BOTH)
</pre>


<p>
重新编译你的内核，并拷贝过去（备份你以前的先）
</p>

<pre>
# make &amp;&amp; make modules_install
# mount /boot
# cp arch/i386/boot/bzImage /boot
</pre>

<p>
如果你将其编译为一个模块，修改/etc/modules.d/aliases，并加上下面一行
</p>

<pre>
alias block-major-97 pktcdvd
</pre>

<p>
创建一个新的设备文件
</p>

<pre>
# mknod /dev/pktcdvd0 b 97 0

<codenote>如果你有一个以上的CD-RW设备，将上面所有的0s改为下一个数字... 因此，对于第二个驱动器，你可以：</codenote>
# mknod /dev/pktcdvd1 b 97 1  
</pre>

<p>
安装udftools
</p>

<pre>
# emerge sys-fs/udftools
</pre>

<p>
编辑/etc/fstab，增加如下行：
</p>

<pre>
/dev/pktcdvd0       /mnt/cdrw      udf           sync,noauto,noatime,rw,users      0 0
</pre>

<p>
确认创建了新文件夹/mnt/cdrw，并给他适当的权限。
</p>

<pre>
# mkdir /mnt/cdrw
# chmod 0777 /mnt/cdrw
</pre>

<p>
用下面命令来格式化一个CD-RW为UDF文件系统：
</p>

<pre>
# cdrwtool -d /dev/scd0 -q
</pre>

<warn>
将你的CD-RW驱动器设为hdc！
</warn>

<p>
你现在可以挂载已被UDF格式化的CD-RWs，用如下命令：
</p>

<pre>
# mount /mnt/cdrw
</pre>

<p>
为你的系统准备CD-RW的写入，将下面文件保存为<path>/etc/init.d/cdrw</path>：
</p>

<pre>
#!/sbin/runscript
# Copyright 1999-2003 Gentoo Technologies, Inc.
# Distributed under the terms of the GNU General Public License v2
# $Header: $
    
      
depend() {
        need localmount
}
  
start() {
        DEVICES="hdd"
        #${COUNT}=0
        for i in ${DEVICES}
        do
                 ebegin "Enabling CD-RW packet writing on /dev/${i}"
                 pktsetup /dev/pktcdvd0 /dev/${i}
                 #${COUNT}=${COUNT}+1
                 eend $? "Failed to enable packet writing on /dev/${i}."
        done
}
     
stop() {
        for i in ${DEVICES}
        do
                 ebegin "Disabling CD-RW packet writing on /dev/${i}"
                 pktsetup -d /dev/pktcdvd0 /dev/${i}
                 eend $? "Failed to disable packet writing on /dev/${i}"
        done
}
       
       
# vim:ts=4
</pre>

<p>
并设定这个文件为可执行。用 /etc/init.d/cdrw start来准备CD-RW写入。我推荐使用 rc-update add cdrw default，这样你的CD-RW驱动器将在每次启动后都可随时准备使用... 确认修改DEVICES="hdd"为合适的设备，目前这支持一个设备，不过不久将会有所改变。
</p>

<p>
接下来该做什么：改进init.d脚本，应该可以在多设备中准确的工作。
</p>

</body>
</chapter>
<chapter>
<title>译者注</title>
<section>
<title>原始出处</title>
<body>

<p>
原始文章出处：<uri>http://forums.gentoo.org/viewtopic.php?t=173263</uri>
</p>

</body>
</section>
<section>
<title>说明</title>
<body>
<p>
此篇翻译献给gentoo版版主Jinduck。
</p>

</body>
</section>
</chapter>
</guide>
