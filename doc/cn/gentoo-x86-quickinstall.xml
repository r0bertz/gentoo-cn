<?xml version='1.0' encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="/xsl/guide.xsl" ?>
<!-- $Header: /var/www/www.gentoo.org/raw_cvs/gentoo/xml/htdocs/doc/en/gentoo-x86-quickinstall.xml,v 1.11 2004/04/14 09:38:41 swift Exp $ -->

<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">

<guide link="/doc/zh_cn/quickinstall.xml">
<title>Gentoo Linux安装指南</title>
<author title="Author">Steven Wagner</author>
<author title="Editor">
  <mail link="swift@gentoo.org">Sven Vermeulen</mail>
</author>
<author title="Translator">
  <mail link="dragonnapalm@163.com">dragonnapalm</mail>
</author>


<abstract>
本快速安装指南提供了一种安装Gentoo的快捷方法。在参考本书之前，你应有
完整安装Gentoo Linux的经验。
</abstract>

<license/>

<version>1.8</version>
<date>April 14, 2004</date>

<chapter>
<title>快速安装指南</title>
<section>
<body>

<p>
所有的安装ISO都可在<uri link=
"http://www.gentoo.org/main/en/mirrors.xml">Gentoo
Mirrors</uri>上找到. 不同CD之间的详细描述可在
<uri link="http://store.gentoo.org">Gentoo
Store</uri>上找到. 
CD 1包含了在不连接到Internet的情况下快速安装Gentoo Linux的所有文件，
CD 2（可选）包含了事先编译好的软件包，比如KDE, GNOME, OpenOffice,
Mozilla, Evolution 以及其他软件。
</p>

<p>
用第一张Gentoo光盘启动计算机，按&lt;F1&gt; 并且/或者按&lt;F2&gt; 查看可用的
启动选项。在启动屏幕按&lt;ENTER&gt;用默认内核启动。最后，你会得到一个命令提示符。
</p>

<pre caption="开始的设置">
# <i>date</i>  (确保你的时间和日期是正确的. 如果有错误, 用<i>date MMDDhhmmCCYY</i>进行设置 )
# <i>modprobe module_name</i>  (可选 - 载入所有必要的模块)
# <i>net-setup eth0</i> (配置网络)
# <i>fdisk /dev/hda</i> (对磁盘进行分区)
</pre>

<p>
推荐的设置是：用ext2的文件格式划分一个64M的boot区，划分一个两倍于可用内存大小的
交换分区，剩余的磁盘空间采用ReiserFS文件格式进行分区。
</p>

<p>
用<c>mke2fs</c> (Ext2文件格式), <c>mke2fs
-j</c> (Ext3文件格式), <c>mkreiserfs</c> (ReiserFS文件格式), <c>mkfs.xfs</c> (XFS文件格式)
<c>mkfs.jfs</c> (JFS文件格式) 以及<c>mkswap</c> (交换分区) 初始化分区并建立磁盘格式.例如:
<c>mke2fs -j /dev/hda3</c>.
</p>

<p>
加载分区，解压合适的stage文件以继续：
</p>

<pre caption="准备安装">
(激活交换分区)                                   # <i>swapon /dev/hdax</i>
(加载root分区)                       		# <i>mount /dev/hdax /mnt/gentoo</i>
(创建启动加载点)                     		# <i>mkdir /mnt/gentoo/boot</i>
(加载boot分区)                       		# <i>mount /dev/hdax /mnt/gentoo/boot</i>
(转到加载点)                           		# <i>cd /mnt/gentoo</i>
(解压stage tarball...)                     	# <i>tar -xvjpf /mnt/cdrom/stages/stage?-*.tar.bz2</i>
(<comment>或者</comment>下载最新的tarball...)              # <i>lynx http://www.gentoo.org/main/en/mirrors.xml</i>
(                  ... 并解压)              	# <i>tar -xvjpf stage*</i>
(可选: 解压portage tree)                		# <i>tar -xvjf /mnt/cdrom/snapshots/portage-*.tar.bz2 -C /mnt/gentoo/usr</i>
(可选: 复制所有的distfiles)                  	# <i>cp -R /mnt/cdrom/distfiles /mnt/gentoo/usr/portage/distfiles</i>
(选择镜像)                                	# <i>mirrorselect -a -s4 -o &gt;&gt; /mnt/gentoo/etc/make.conf</i>
(复制所有的nameserver信息)               		# <i>cp /etc/resolv.conf /mnt/gentoo/etc/resolv.conf</i>
(加载proc文件系统)                      		# <i>mount -t proc none /mnt/gentoo/proc</i>
(Chroot到新环境中)                			# <i>chroot /mnt/gentoo /bin/bash</i>
(加载所需的变量)              			# <i>env-update; source /etc/profile</i>
(仅网络用户,非GRP用户: 更新 Portage)     		# <i>emerge sync</i>
</pre>

<p>
现在开始安装Gentoo:
</p>

<pre caption = "安装Gentoo">
(更改 USE, CFLAGS 和 CXXFLAGS. 在Stage1 也可更改CHOST)  # <i>nano -w /etc/make.conf</i>
(仅Stage1: bootstrap系统)                             # <i>cd /usr/portage; scripts/bootstrap.sh</i>
(仅Stage1, Stage2: 安装基本系统)                       # <i>emerge system</i>
</pre>

<p>
下一步我们设置必要的信息：
</p>

<pre caption = "设置配置文件">
(设置时区)                        # <i>ln -sf /usr/share/zoneinfo/<comment>&lt;指向时区文件的路径&gt;</comment> /etc/localtime</i>
(编辑fstab文件)                                 # <i>nano -w /etc/fstab</i>
</pre>

<p>
下面是一个设置<path>/etc/fstab</path>的<e>范例</e> (不要完全照搬) ：
</p>

<pre caption="/etc/fstab">
# &lt;fs&gt;                  &lt;mountpoint&gt;    &lt;type&gt;          &lt;opts&gt;                  &lt;dump/pass&gt;
/dev/hdax               /boot           ext2            noauto,noatime          1 2
/dev/hdax               none            swap            sw                      0 0
/dev/hdax               /               reiserfs        noatime                 0 1
/dev/cdroms/cdrom0      /mnt/cdrom      auto            noauto,user             0 0
none                    /proc           proc            defaults                0 0
none                    /dev/shm        tmpfs           defaults                0 0
</pre>

<p>
安装Linux内核以继续：
</p>

<pre caption="安装内核">
(安装内核源文件)                               # <i>emerge <comment>&lt;内核文件&gt;</comment></i>
(用genkernel配置内核...)                 # <i>emerge genkernel; genkernel --menuconfig all</i>
(<comment>或者</comment> (1)手动建立内核)                        # <i>cd /usr/src/linux; make menuconfig;</i>
(   (2) Include VM fs, /proc fs, /dev fs,  /dev fs auto mount at boot)
(   (3) 编译内核)                               # <i>make dep &amp;&amp; make clean bzImage modules modules_install</i>
(   (4) 复制内核)                              # <i>cp arch/i386/boot/bzImage /boot; cp System.map /boot</i>
</pre>

<p>
现在安装其它的你可能需要的工具：
</p>

<pre caption = "安装重要的系统工具">
(安装系统日志; 可以选择: sysklogd, metalog, msyslog, syslog-ng) # <i>emerge syslog-ng </i>
(让日志在系统启动时自动运行)                  # <i>rc-update add syslog-ng default</i>
(安装 cron 后台程序;可以选择: vixie-cron, dcron, fcron)                # <i>emerge vixie-cron</i>
(让cron后台程序在系统启动时自动运行)                   # <i>rc-update add vixie-cron default</i>   
(仅针对使用genkernel 的: 安装热插拔（Hotplug）)                                # <i>emerge hotplug</i>
(仅针对使用genkernel 的: 让热插拔（Hotplug）在系统启动时自动运行)     # <i>rc-update add hotplug default</i>
(仅针对不使用ext2,ext3的; 可以选择: reiserfsprogs, xfsprogs, jfsutils)  # <i>emerge reiserfsprogs</i>
(域名init脚本)                                              # <i>rc-update add domainname default</i>
</pre>

<p>
如果你需要特定的内核 ebuild,现在是时候安装它们了：
</p>

<pre caption = "安装特定的内核Ebuild">
# <i>emerge pcmcia-cs</i> (或者<i>nforce-net</i>, <i>nforce-audio</i>, <i>e100</i>, <i>e1000</i>, <i>ati-drivers</i>, <i>rp-pppoe</i>)
# <i>VIDEO_CARDS="yourcard" emerge xfree-drm</i>   (针对ATI Radeon （最高支持到Radeon9200）, Rage128, Matrox, Voodoo以及其他显卡)
</pre>

<p>
为你的Gentoo系统完成设置：
</p>

<pre caption = "完成配置设置">
(设置root密码)                                      # <i>passwd</i>
(创建一个用户帐号)                                          # <i>useradd your_user -m -G users,wheel,audio -s /bin/bash</i>
(为那个用户设置密码)                             # <i>passwd your_user</i>
(设置系统的主机名)                                # <i>echo mymachine &gt; /etc/hostname</i>
(设置系统的域名)                              # <i>echo mydomain.com &gt; /etc/dnsdomainname</i>
(设置hostsfile, 如:"127.0.0.1 localhost mymachine")  # <i>nano -w /etc/hosts</i>
(配置基本系统设置;请按照注解进行)       # <i>nano -w /etc/rc.conf</i>
</pre>

<pre caption = "配置网络">
(配置网络; 如果使用dhcp则应该设置 iface_eth0="dhcp")      # <i>nano -w /etc/conf.d/net</i>
(列出启动时需要加载的模块)                           # <i>nano -w /etc/modules.autoload.d/kernel-<comment>&lt;version&gt;</comment></i>
(仅针对不使用PCMCIA的: 启动时自动开启网络)        # <i>rc-update add net.eth0 default</i>
(如果你有多个网络接口:)
   (1)为每个接口创建initscripts )                    # <i>ln -s /etc/init.d/net.eth0 /etc/init.d/net.ethx</i>
   (2) 如果没有PCMCIA，在启动时自动加载它们)                 # <i>rc-update add net.ethx default</i>
(仅针对使用PCMCIA的 : 验证 /etc/conf.d/pcmcia 并在启动时加载PCMCIA) # <i>rc-update add pcmcia boot</i>
</pre>

<p>
现在开始安装bootloader.
</p>

<pre caption="安装并配置GRUB">
# <i>emerge grub</i>
# <i>grub</i>
grub&gt; <i>root (hd0,0)</i>
grub&gt; <i>setup (hd0)</i>
grub&gt; <i>quit</i>
# <i>nano -w /boot/grub/grub.conf</i>
default 0
timeout 15
splashimage=(hd0,0)/grub/splash.xpm.gz

title=Gentoo Linux
  root (hd0,0)
  <comment># 使用genkernel的:</comment>
  kernel /kernel-<comment>&lt;内核版本&gt;</comment> root=/dev/ram0 init=/linuxrc real_root=/dev/hda3
  initrd /initrd-<comment>&lt;内核版本&gt;</comment>
  <comment>#不使用genkernel的:</comment>
  kernel /kernel-<comment>&lt;内核版本&gt;</comment> root=/dev/hda3
</pre>

<pre caption="安装并配置LILO">
# <i>emerge lilo</i>
# <i>nano -w /etc/lilo.conf</i>
boot=/dev/hda
prompt
timeout=50
default=gentoo

image=/boot/kernel-<comment>&lt;内核版本&gt;</comment> 
  label=gentoo
  read-only
  <comment># 使用genkernel的:</comment>
  append="init=/linuxrc real_root=/dev/hda3"
  root=/dev/ram0
  initrd=/boot/initrd-<comment>&lt;内核版本&gt;</comment>
  <comment>#不使用genkernel的:</comment>
  root=/dev/hda3

# <i>/sbin/lilo</i>
</pre>

<p>
现在卸载你所有的分区，并重新启动到新系统中：
</p>

<pre caption="完成并安装GUI">
(退出chroot)                                     # <i>exit; cd /</i>
(卸载分区)                                       # <i>umount /mnt/gentoo/boot /mnt/gentoo/proc /mnt/gentoo</i>
(重新启动;并将安装光盘从光驱中取出)                # <i>reboot</i>
(重新启动之后:)
(仅针对ADSL用户)                                 # <i>adsl-setup</i>
(仅针对GRP用户)
(  (1) 挂载 CD2)                                # <i>mount /dev/cdrom /mnt/cdrom</i>  
(  (2) 复制所有的软件包)                         # <i>cp -a /mnt/cdrom/packages/* /usr/portage/packages/</i>
(  (3) 安装额外的软件)                           # <i>USE="bindist" emerge -k xfree gnome kde mozilla openoffice-bin</i>
(  (4) 配置你的Xserver)                          # <i>/usr/X11R6/bin/xf86config</i>
</pre>

<p>
你还可以从<uri
link="http://www.gentoo.org/doc/en/index.xml">Gentoo
文档</uri>获得更多信息.
</p>
</body>
</section>
</chapter>	
</guide>

