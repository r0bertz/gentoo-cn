<?xml version='1.0' encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="/xsl/guide.xsl" ?>
<!DOCTYPE guide SYSTEM "/dtd/guide.dtd">
<!-- $Header: /var/www/www.gentoo.org/raw_cvs/gentoo/xml/htdocs/doc/en/metadata.xml,v 1.4 2004/03/07 12:12:53 swift Exp $ -->

<guide link="/doc/zh_cn/dvdmenu.xml">
<title>怎么在linux下创建带菜单的DVD</title>

<author title="Author">
  <mail link="">shiznix</mail>
</author>
<author title="Translator/Editor">
  <mail link="joanphan@gmail.com">Hans Joanphan</mail>
</author>

<abstract>
在linux下创建有菜单的DVD。
</abstract>

<license/>

<version>0.1</version>
<date>2004年7月22日</date>

<chapter>
<title>正文</title>
<section>
<title>前言</title>
<body>

<p>
虽然现在在linux中有图形化界面的工具来创造带菜单的DVD，现在在命令行界面和一些工具的帮助下完成此事也成为可能。
</p>

<p>
这份文档是为帮助那些准备做如下事情的人们：
</p>

<ul>
<li>完成将一个视频文件（.avi, .mpg, .wmv, .mov, etc.）转还为可以在一个标准DVD播放器可以播放的DVD介质中。</li>
<li>创建专业风格的带有音频的菜单，允许选择标题、段落和其他的菜单。</li>
</ul>

</body>
</section>
<section>
<title>工具</title>
<body>

<p>
所需要的工具：
</p>

<ul>
<li>最新的mjpegtools 1.6.2</li>
<li>最新的transcode 0.6.12</li>
<li>最新的dvd+rw-tools 5.16.4.8.6</li>
<li>Mencoder (包含在mplayer软件包中)，<c>USE="encode" emerge mplayer</c></li>
<li>GIMP图像处理程序</li>
<li>Dvdauthor 0.6.9</li>
</ul>

<note>
如果要升级的话，你还需要来修正库文件依赖性问题，如下：
</note>

<pre>
# emerge gentookit
# ACCEPT_KEYWORDS="~x86" revdep-rebuild
</pre>

<p>
选用的工具：
</p>

<ul>
<li>Xine - 在烧录DVD之前测试一下DVD菜单，<c>emerge xine-ui</c></li>
<li>Normalize - 规范音频.pcm/.wav文件的音量</li>
<li>Toolame</li>
</ul>

<p>
为方便读起来更简单，我将使用一些真的文件名，并且将他们和所有新创建的文件放置在同一个文件夹。
出于练习的目的，我选用了两个视频文件，是从<uri>http://www.matrix-xp.com</uri>下载的，我将文件名分别改为<path>matrix.mpg</path>和<path>outtakes.mpg</path>。
我也将使用THX主题作为DVD启动的主题，命民为<path>thx.mpg</path>。
如果你打算将这些应用于个人使用之外，请注意版权问题。
</p>

</body>
</section>
<section>
<title>编码</title>
<body>

<p>
给电影编码
知道或找出你将使用什么TV格式。
对于欧洲和澳大利亚大部分地区来说，使用PAL。
对于美洲（或者其他？），使用NTSC。
</p>

<pre caption="对于PAL:">
# transcode -i matrix.mpg -V -y mpeg -F d -Z 352x288 --export_fps 25 --export_asr 2 -E 48000 -b 224 -o matrix
# transcode -i outtakes.mpg -V -y mpeg -F d -Z 352x288 --export_fps 25 --export_asr 2 -E 48000 -b 224 -o outtakes
# transcode -i thx.mpg -V -y mpeg -F d -Z 352x288 --export_fps 25 --export_asr 2 -E 48000 -b 224 -o thx
</pre>

<pre caption="对于NTSC:">
# transcode -i matrix.mpg -V -y mpeg -F d -Z 352x240 --export_fps 29.97 --export_asr 2 -E 48000 -b 224 -o matrix
# transcode -i outtakes.mpg -V -y mpeg -F d -Z 352x240 --export_fps 29.97 --export_asr 2 -E 48000 -b 224 -o outtakes
# transcode -i thx.mpg -V -y mpeg -F d -Z 352x240 --export_fps 29.97 --export_asr 2 -E 48000 -b 224 -o thx
</pre>

<p>
以上将会产生六个文件<path>matrix.m2v/matrix.mpa</path>，<path>outtakes.m2v/outtakes.mpa</path>， <path>thx.m2v/thx.mpa</path>，这些文件已经从原始文件中分为单独的视频和音频文件。视频（.m2v）已经编码为DVD兼容的格式，音频（.mpa）已经重新采样并编码（从标准的44kHZ的采样率转为DVD需要的48kHZ的采样率）。
</p>

<pre>
# mplex -f 8 -o matrix_dvd.mpg matrix.m2v matrix.mpa
# mplex -f 8 -o outtakes_dvd.mpg outtakes.m2v outtakes.mpa
# mplex -f 8 -o thx_dvd.mpg thx.m2v thx.mpa
</pre>

<p>
以上将会将新产生的音频和视频合并为DVD视频文件。
可以用mplayer或xine来检验这些文件。比如：<c>mplayer -vo xv matrix_dvd.mpg</c>
</p>

<p>
对于非标准的文件格式，如.wmv, .mov, .asf等等。必须用mencoder将电影编码为.avi格式，如同这样：
</p>

<pre caption="对于PAL:">
# mencoder -o ouput_file.avi -ovc lavc -oac lavc -ofps 25 your_movie.mov
</pre>

<pre caption="对于 NTSC:">
# mencoder -o ouput_file.avi -ovc lavc -oac lavc -ofps 29.97 your_movie.mov
</pre>

<p>
然后可以像前面正常情况下使用transcode命令。
如果mencoder出错，提示如下信息：
</p>

<pre>
Quote:
Couldn't open codec mp2, br=224
</pre>

<p>
那么试着将下面其中的一行到你的mencoder语句中：
</p>

<pre>
-channels 2
-srate 22050
-srate 32000
-srate 48000
</pre>

<pre caption="注意事项">
<codenote>如果音频／视频（AV）同步不准确，试着transcode的AV同步自动修正参数换为'-D 0'如下：</codenote>
# transcode -i matrix.mpg -V -y mpeg -F d,1 --export_fps 25 -Z 352x288 --export_asr 2 -E 48000 -b 224 -D 0 -o matrix

<codenote>如果transcode出错或被拒绝，用mplayer辅助transcoe如这样：</codenote>
# transcode -i matrix.mpg -V -x mplayer,mplayer -y mpeg -F d -Z 352x288 --export_fps 25 --export_asr 2 -E 48000 -b 224 -o matrix

<codenote>记住，你可以在用trancode编码时用mplayer或xine来预览.m2v文件。没必要等到编码完成后在来看结果，这对比较大的电影方便。</codenote>
</pre>

</body>
</section>
<section>
<title>创建菜单</title>
<body>

<ul>
<li>对于PAL：打开Gimp程序，创建一个大小为720x576，分辨率为75dpix80dpi的新图像。</li>
<li>对于NTSC：创建一个大小为720x480，分辨率为81dpix72dpi的新图像。</li>
</ul>

<p>
在图像上鼠标右击，选择<path>Image -> Alpha -> Add chanel</path>。
在图像上鼠标右击，选择<path>Image -> Layers -> Layers, Channels &amp; Paths</path>
创建层<path>button_highlight</path>、<path>button_select</path>。
选择背景层，画出菜单的背景图像。
</p>

<p>
我选用<path>matrix 'green data dribble'</path> 作为背景，这是我从一个免费墙纸网站中下载下来的。
调整图像的大小到准确的720x576，鼠标点击图像选择<path>Image -> Scale Image &amp; set</path>。 然后复制或粘贴到我新建图像文件的背景中。
这里有这个<uri link="http://mightylegends.zapto.org/dvd/matrix.jpg">图像文件</uri>。
</p>

<p>
我希望对于不同的电影，菜单中有可选择的快照。
快照可由xine截取得，图像大小再由gimp修改，然后粘贴到背景层中。
这里有这个<uri link="http://mightylegends.zapto.org/dvd/..._background.jpg">图像文件</uri>
</p>

<p>
选择button_highlight层，勾划出按钮形状。要看如果在gimp中画出完美的长方形、正方形和圆形，可以参看<uri link="http://www.cubicdesign.com/gimp/1_3/">这里</uri>。
这里有这个<uri link="http://mightylegends.zapto.org/dvd/...u_highlight.png">图像文件</uri>。
</p>

<p>
隐藏<path>button_highlight</path>层，并保存背景层。
做这个我们可以如下做：选择<path>button_highlight</path>层，并在这些层、频道和路径（Layers, Channels and Paths）中应用不透明滑动块（Opacity slider），使他不可见。
点击背景层，右击图像，选择<path>File -> Save as</path>
保存背景层为<path>matrix_menu_background.jpg</path>。
</p>

<note>
背景必须为jpg格式。
</note>

<p>
同样的方法选择<path>button_highlight</path>层。使用不透明滑动块（Opacity slider）使button_highlight层恢复，隐藏背景层。
点击<path>button_highlight</path>层，右击图像，选择<path>File -> Save as</path>
保存<path>button_highlight</path>层为<path>matrix_menu_highlight.png</path>。
</p>

<note>
按钮层必须为png格式。
</note>

<p>
选择<path>button_select</path>层，并勾划出和<path>button_highlight</path>一样的按钮，但颜色不一样。一个简单的方法是打开<path>matrix_menu_highlight.png</path>，右键点击图像，选择<path>Image -> Colors -> Color map rotation</path>，选择一个不同的颜色，但是在菜单背景中可以显现的颜色。
将这个新的图像保存为<path>matrix_menu_select.png</path>。
这里有这个<uri link="http://mightylegends.zapto.org/dvd/...menu_select.png">图像文件</uri>。
</p>

<note>
必须为png格式。
</note>

</body>
</section>
<section>
<title>菜单背景</title>
<body>

<pre caption="对于PAL:">
# jpeg2yuv -n 50 -I p -f 25 -j matrix_menu_background.jpg | mpeg2enc -n p -f 8 -o matrix_menu_background.m2v
</pre>

<pre caption="对于NTSC：">
# jpeg2yuv -n 50 -I p -f 29.97 -j matrix_menu_background.jpg | mpeg2enc -n n -f 8 -o matrix_menu_background.m2v
</pre>

<p>
还可以根据自己爱好添加一些音乐：
</p>

<pre>
<codenote>给菜单创建一些背景音乐</codenote>
# mplayer yourmusicfile.mp3 -vo null -ao pcm -aofile menu_audio.pcm

<codenote>根据需要用normalize是音量柔和点或大声点</codenote>
# normalize -a -10dB menu_audio.pcm

<codenote>转还为mpge音频：</codenote>
# mp2enc -r 48000 -o menu_audio.mpa &lt; menu_audio.pcm
</pre>

<p>
如果你不需要在你的菜单中添加音乐，仍然需要创建一个静音的音频文件和DVD菜单组合，这样菜单工作才能正常。如下：
</p>

<pre caption="对于PAL：">
# dd if=/dev/zero bs=4 count=1920 | toolame -b 128 -s 48 /dev/stdin menu_audio.mpa
</pre>

<pre caption="对于NTSC：">
# dd if=/dev/zero bs=4 count=1601.6 | toolame -b 128 -s 48 /dev/stdin menu_audio.mpa
</pre>

<p>
组合菜单背景视频和音频：
</p>

<pre>
# mplex -f 8 -o matrix_menu.mpg matrix_menu_background.m2v menu_audio.mpa
</pre>

<p>
用<path>spumux</path>来将<path>button_highlight</path>和<path>button_select</path>图像融入菜单视频中。
Spumux是dvdauthor软件包的一部分。他通过一个xml文件配置。这里有我们要用到的一个xml配置文件，保存为<path>spumux.xml</path>：
</p>

<pre>
&lt;subpictures&gt;
&lt;stream&gt;
&lt;spu start="00:00:00.0" end="00:00:00.0"
highlight="matrix_menu_highlight.png"
select="matrix_menu_select.png"
autooutline="infer"
autoorder="rows"/&gt;
&lt;/stream&gt;
&lt;/subpictures&gt;
</pre>

<p>
创建最后的menu视频
</p>

<pre>
# spumux spumux.xml &lt; matrix_menu.mpg &gt; matrix_menu_final.mpg
</pre>


</body>
</section>
<section>
<title>创建DVD</title>
<body>

<p>
Dvdauthor通过一个xml文件配置。这里有一个我们要用到的xml配置文件，保存为<path>dvdauthor.xml</path>：
</p>

<pre>
&lt;dvdauthor dest="DVD"&gt;

&lt;vmgm&gt;
&lt;menus&gt;
&lt;pgc&gt;
&lt;vob file="thx_dvd.mpg"/&gt;
&lt;post&gt;
jump titleset 1 menu;
&lt;/post&gt;
&lt;/pgc&gt;
&lt;/menus&gt;
&lt;/vmgm&gt;

&lt;titleset&gt;
&lt;menus&gt;
&lt;pgc&gt;
&lt;button&gt; jump title 1; &lt;/button&gt;
&lt;button&gt; jump title 2; &lt;/button&gt;
&lt;vob file="matrix_menu_final.mpg" pause="inf"/&gt;
&lt;/pgc&gt;
&lt;/menus&gt;

&lt;titles&gt;
&lt;pgc&gt;
&lt;vob file="matrix_dvd.mpg"/&gt;
&lt;post&gt;
call menu;
&lt;/post&gt;
&lt;/pgc&gt;
&lt;/titles&gt;

&lt;titles&gt;
&lt;pgc&gt;
&lt;vob file="outtakes_dvd.mpg" /&gt;
&lt;post&gt;
call menu;
&lt;/post&gt;
&lt;/pgc&gt;
&lt;/titles&gt;

&lt;/titleset&gt;

&lt;/dvdauthor&gt;
</pre>

<p>
创建一个文件夹名为DVD。
创建DVD文件价格用如下命令：
</p>

<pre>
# dvdauthor -x dvdauthor.xml
</pre>

<p>
在刻录之前用xine测试一下新的菜单：
</p>

<pre>
# xine dvd:/full/path/to/DVD/VIDEO_TS/
</pre>

<p>
xine应该播放这个文件夹就和播放一个DVD一样。
</p>

<p>
理解DVD的分层结构
</p>

<ul>
<li>VMGM：也称作主菜单，处于DVD视频结构的最好级别。</li>
<li>标题集（Titleset）：每个DVD至少包含一个标题集。所有的一个给定的标题集相联系的文件都以VTS_nn的形式出现（nn是标题集的标号，标号从1开始）。</li>
<li>标题：每个标题集包含一个或多个标题。每个标题事实上相当于一个独立的电影。如果你启动xine，并且只是告诉他去打开一个DVD，如果这个DVD没有一个更高级别的菜单，程序将会只播放第一个标题集的第一个标题就停止了。</li>
<li>段落：每个标题都再细分为几个段落。段落提供指向电影的记录，但是当播放器播到一个段落的最后，播放器将会继续播放下一个段落。</li>
</ul>

<p>
菜单可以和整个联系起来（此时称为视频管理菜单VMGM），也可和一个标题集联系起来（此时称为视频标题集菜单VTSM）。每种类型都可以有多于一个的菜单。
当在不同标题集时不止一个的VTSM需要是，典型情况下将会是用VMGM菜单，因为在不同标题集时一个VTSM不会自动跳到另一个VTSM。
</p>

<p>
导航菜单对象的限制如下：
</p>

<p>
一个VMGM菜单只能跳到：
</p>

<ul>
<li>另一个VMGM菜单</li>
<li>一个标题集的第一个VTSM</li>
<li> 一个标题集的开始</li>
</ul>

<p>
一个VTSM菜单只能跳到：
</p>

<ul>
<li>同一个标题集的另一个VTSM</li>
<li>标题集中的一个标题或段落</li>
<li>磁盘的第一个VMGM</li>
</ul>

<p>
我的DVD播放器（或者其他的？）在遥控器恩'Disc'键时默认到第一个VTSM。如果是这种情况，而你又需要设置菜单可以在VMGM级别上访问另一个不同的VTSMs，你需要设置第一个VTSM如下：
</p>

<pre>
&lt;titleset&gt;
&lt;menus&gt;
&lt;pgc&gt;
&lt;post&gt;
jump vmgm menu;
&lt;/post&gt;
&lt;/pgc&gt;
&lt;/menus&gt;
&lt;titles&gt;....
<codenote>这样摁'Disc'键可以让你进入VMGM菜单。</codenote>
</pre>

<p>
创建DVD镜像文件并刻录。
使用growisofs工具，这事dvd+rw-tools软件包的一部分。
</p>

<pre>
# growisofs -Z /dev/dvd -dvd-video DVD/
</pre>

<note>
但愿你能成功使DVD工作起来
当然，更复杂的菜单可以通过增加段落到你得电影和创建嵌入式菜单（菜单一层套一层）。而这只是一个初学者的使用向导，只用到两个标题。
虽然咋看起来这有点复杂和浪费时间，但是一旦你做过几次，将会变得越来越迅速和简单。
在命令行下而不是图形化界面下编码也意为着非常快速。（大概三倍速度于在我弱弱的XP1800+下的Windows操作系统）
一些工作在图形化界面完成确实不错，但是需要太多的工具来完成这个。我认为这将需要一个开发队伍大量的工作。
</note>

</body>
</section>
<section>
<title>感谢：</title>
<body>

<ul>
<li>Scott T. Smith - 优秀的工具dvdauthor的作者</li>
<li>Thomas Oestrich - transcode的作者</li>
<li>The mjpeg team</li>
<li>Wolfgang Wershofen - 感谢他准确和仔细的帮助</li>
<li>Ian Pointer - 感谢他在linuxjournal.com的文章Issue# 116</li>
<li>James A. Pattie - 感谢他的关于'DVDs under Linux'讲演</li>
<li>James Tappin - 感谢他的写的dvdauthor使用说明</li>
</ul>

</body>
</section>
<section>
<title>链接：</title>
<body>

<ul>
<li>Wolfgang Wershofen 已经做了一些有趣的工作，完成了一些不同的xml配置文件和一个自动完成整个菜单创建的脚本。这些东西可以在这里找到：
<uri>http://www.wershofen.de/donwloads/dvdauthor.xml</uri>
<uri>http://www.wershofen.de/downloads/dvdauthor_example.tar.gz</uri>
<uri>http://www.wershofen.de/downloads/dvdwizard.tar.gz</uri></li>
<li><uri>http://www.linuxjournal.com</uri> - 一个有关在linux下创建DVD的有意思的文章。</li>
<li><uri>http://www.pcxperience.org/james/dvd/presentations/</uri> - James Pattie's DVD讲座</li>
<li><uri>http://www.tappin.me.uk/Linux/dvd.html</uri> - James Tappin的dvdauthor使用手册（现在已经更新，向那些想将DVB转换为DVD的人强烈推荐）</li>
</ul>

</body>
</section>
</chapter>
<chapter>
<title>译者注</title>
<section>
<title>原始出处</title>
<body>

<p>
原始文章出处：<uri>http://forums.gentoo.org/viewtopic.php?t=117709</uri>
</p>

</body>
</section>
<section>
<title>说明</title>
<body>
<p>
此篇翻译献给gentoo版版主Jinduck。
</p>

</body>
</section>
</chapter>
</guide>
